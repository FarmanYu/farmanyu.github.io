<!DOCTYPE html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
</head>
<body>
	<!--a id="output-pic" download="temp" href="" style="position:absolute;top:400px;">导出图片</a-->
</body>
<script src="js/jquery.js"></script>
<!--导入引擎js部分-->
<script charset='utf-8' src="xengine/xcore.js"></script>
<script charset='utf-8' src="xengine/xutil.js"></script>
<script charset='utf-8' src="xengine/xevent.js"></script>
<script charset='utf-8' src="xengine/xsys.js"></script>
<script charset='utf-8' src="xengine/xrenderobj.js"></script>
<script charset='utf-8' src="xengine/xscene.js"></script>
<script charset='utf-8' src="xengine/xscenemanager.js"></script>
<script charset='utf-8' src="xengine/xapp.js"></script>
<!--游戏js部分-->
<script charset='utf-8' src="js/ball.js"></script>
<script charset='utf-8' src="js/game.js"></script>

<script>
	function renderPic(width, height, datas, bg){
		var canvas = $("<canvas />");
		canvas.attr("width", width);
		canvas.attr("height", height);
		bg = bg || "#000000";
		var ctx = canvas[0].getContext("2d");
		ctx.fillStyle = bg;
		ctx.fillRect(0,0,width,height);
		datas.forEach(function(imgdata){
			 ctx.drawImage(imgdata, 0 ,0 , width, height);
		});

		return canvas[0].toDataURL("png");
	}

	var $outputPic = $("#output-pic");
	$outputPic.on("click", function (e) {
		e.stopPropagation();
		var canvas = $("canvas")[0];
		var width = $("canvas").width();
		var height = $("canvas").height();
		g.pause();
		var imgData =  canvas.toDataURL("png");
		//console.log(imgData);
		var img = new Image();
		img.width = width;
		img.height = height;
		img.src = imgData;
		$(img).attr("style", "background-color:black;position:absolute;top:500px;");

		var url = renderPic(width, height, [img]);
		console.log(url);

		$outputPic.attr("href", url);

		$("body").append(img);

		setTimeout(function(){
			  g.paused = false;
		}, 3000)
	});

	

</script>
</html>